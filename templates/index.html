
<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Expense Tracker</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: { extend: { colors: { brand: { DEFAULT: "#38bdf8" } } } },
      };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body class="h-full bg-slate-900 text-slate-100">
    <main class="mx-auto max-w-6xl px-4 py-8">
      <!-- Flash messages -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="space-y-2 mb-4">
          {% for category, message in messages %}
          <div
            class="rounded-xl px-4 py-3 text-sm {% if category == 'success' %} bg-emerald-500/10 text-emerald-300 border border-emerald-400/20 {% elif category == 'error' %} bg-rose-500/10 text-rose-300 border border-rose-400/20 {% else %} bg-slate-800 text-slate-200 border border-slate-700 {% endif %}"
          >
            {{ message }}
          </div>
          {% endfor %}
        </div>
        {% endif %}
      {% endwith %}
      
      <h1 style="font-family: sans-serif; padding: 10px; text-align: center; font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem;">
  <span style="color: #007bff; font-weight: bold;">Expense</span> 
  <span style="color: #ffffff; font-weight: bold;">Tracker</span>
      </h1>
      <p class="text-slate-400 mb-6" style="text-align: center;">
        Track spending, filter by date/category, and visualize instantly.
      </p>
      
      <!-- Filters + Add form -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-4" style="display: flex; justify-content:center; align-items: center;">
        <!-- Filters -->
        <section
          class="lg:col-span-2 rounded-2xl border border-slate-800 bg-slate-900 p-4"
        >
          <h2 class="text-lg font-semibold mb-3">Filters</h2>
          <form method="get" action="{{ url_for('index') }}"
            class="grid grid-cols-1 md:grid-cols-5 gap-3 items-end pr-5">
            <label class="text-sm">
              <span class="block mb-1 text-slate-300">Start</span>
              <input
                name="start"
                value="{{start_str or ''}}"
                type="date"
                class="w-full rounded-xl bg-slate-800 border border-slate-700 px-3 py-2 text-slate-100"
              />
            </label>
            <label class="text-sm">
              <span class="block mb-1 text-slate-300">End</span>
              <input
                name="end"
                value="{{end_str or ''}}"
                type="date"
                class="w-full rounded-xl bg-slate-800 border border-slate-700 px-3 py-2 text-slate-100"
              />
            </label>
            <label class="text-sm md:col-span-2">
              <span class="block mb-1 text-slate-300">Category</span>
              <select name="category"
                class="w-full rounded-xl bg-slate-800 border border-slate-700 px-3 py-2 text-slate-100"
              >
                <option value="">All</option>
                {% for c in categories %}
                <option value="{{c}}" {% if c == selected_category %}selected{% endif %}>{{c}}</option>
                
                {% endfor %}
              </select>
            </label>
            <div class="flex gap-2">
              <button
                class="rounded-xl bg-brand/20 hover:bg-brand/30 text-brand px-4 py-2 border border-brand/30"
                type="submit"
              >
                Apply
              </button>
              <a
                class="rounded-xl bg-slate-800 hover:bg-slate-700 px-4 py-2 border border-slate-700"
                href="{{ url_for('index') }}"
                >Reset</a
              >
            </div>
          </form>
          <!-- Total -->
          <div class="mt-4 text-sm text-slate-300">
            <span class="mr-2">Total:</span>
            <span
              class="inline-block rounded-xl border border-slate-700 bg-slate-800 px-3 py-1 font-semibold"
            >
             <span>&#8377 {{ '%.2f' | format(total or 0) }}</span> 
            </span>
          </div>
 <!-- Add Expense -->
        <section class="rounded-2xl border border-slate-800 bg-slate-900 p-4 mt-7">
          <h2 class="text-lg font-semibold mb-3">Add Expense</h2>
          <form 
          method="post"
          action="{{ url_for('add') }}"
          class="space-y-3">
            <label class="block text-sm">
              <span class="mb-1 block text-slate-300">Description</span>
              <input
                name="description"
                placeholder="e.g., Groceries"
                class="w-full rounded-xl bg-slate-800 border border-slate-700 px-3 py-2 text-slate-100"
              />
            </label>
            <div class="grid grid-cols-2 gap-3">
              <label class="block text-sm">
                <span class="mb-1 block text-slate-300">Amount</span>
                <input
                  name="amount"
                  type="number"
                  step="0.01"
                  min="0.01"
                  placeholder="250.0"
                  class="w-full rounded-xl bg-slate-800 border border-slate-700 px-3 py-2 text-slate-100"
                />
              </label>
              <label class="block text-sm">
                <span class="mb-1 block text-slate-300">Date</span>
                <input
                  name="date"
                  value="{{today}}"
                  type="date"
                  class="w-full rounded-xl bg-slate-800 border border-slate-700 px-3 py-2 text-slate-100"
                />
              </label>
           
            </div>
            <label class="block text-sm">
              <span class="mb-1 block text-slate-300">Category</span>
              <select
                name="category"
                class="w-full rounded-xl bg-slate-800 border border-slate-700 px-3 py-2 text-slate-100"
              >
                {% for c in categories%}
                <option value="{{c}}"> {{c}}</option>
                
                {% endfor %}
              </select>
            </label>
            <button
              class="w-full rounded-xl bg-brand/20 hover:bg-brand/30 text-brand px-4 py-2 border border-brand/30"
              type="submit"
            >
              Add Expense
            </button>
          </form>
        </section>
      </div>

      <!-- Total (global) -->
      <div class="mb-3 mt-6">
        <span class="text-sm text-slate-300 mr-2">Total:</span>
        <span
          class="inline-block rounded-xl border border-slate-700 bg-slate-800 px-3 py-1 font-semibold"
        >
          <span>&#8377</span> {{ '%.2f' | format(total or 0) }}
        </span>
      </div>

      <!-- Expenses table -->
      <section class="rounded-2xl border border-slate-800 bg-slate-900">
        <div class="px-4 py-3 border-b border-slate-800">
          <h2 class="text-lg font-semibold">Expenses</h2>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead class="text-slate-300 bg-slate-800/50">
              <tr>
                <th class="text-left px-4 py-3">Date</th>
                <th class="text-left px-4 py-3">Description</th>
                <th class="text-left px-4 py-3">Category</th>
                <th class="text-right px-4 py-3">Amount</th>
                <th class="px-4 py-3"></th>
              </tr>
            </thead>
            <tbody>
              {% if expenses %}
                {% for e in expenses %}
                <tr class="border-t border-slate-800 hover:bg-slate-800/30">
                  <td class="px-4 py-2">{{e.date.strftime("%Y-%m-%d") if e.date else ""}}</td>
                  <td class="px-4 py-2">{{e.description}}</td>
                  <td class="px-4 py-2">{{e.category}}</td>
                  <td class="px-4 py-2 text-right"><span>&#8377</span>{{'%.2f' | format(e.amount) }}</td>
                  <td class="px-4 py-2 text-right">
                  <div class="inline-flex gap-2"> 
                       <a class="text-sky-300 hover:text-sky-200 text-xs
                       border border-sky-400/30 px-3 py-1 rounded-lg"
                       href="{{ url_for('edit', expense_id=e.id) }}">EDIT</a> 
                    <form 
                    method="post"
                    action="{{ url_for('delete',expense_id=e.id) }}" 
                    onsubmit="return confirm('Are you sure , you want to delete?')">
                    <button
                      class="text-rose-300 hover:text-rose-200 text-xs border border-rose-400/30 px-3 py-1 rounded-lg"
                    >
                      Delete
                    </button>
                    </form>

                </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="5" class="px-4 py-6 text-center text-slate-400">
                    No expenses yet â€” add your first one above.
                  </td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </section>

      <!-- Charts -->
      <section class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-4">
        <div class="rounded-2xl border border-slate-800 bg-slate-900 p-4">
          <h3 class="font-semibold mb-2">By Category</h3>
          <canvas id="catChart" height="140"></canvas>
        </div>
        <div class="rounded-2xl border border-slate-800 bg-slate-900 p-4">
          <h3 class="font-semibold mb-2">Spending Over Time</h3>
          <canvas id="dayChart" height="140"></canvas>
        </div>
      </section>
      <script>
      const catLabels = {{ (cat_labels or []) | tojson }};
      const catValues = {{ (cat_values or []) | tojson }};
      const dayLabels = {{ (day_labels or []) | tojson }};
      const dayValues = {{ (day_values or []) | tojson }};

      if (document.getElementById('catChart')) {
        const ctxCat = document.getElementById('catChart').getContext('2d');
        const catChart = new Chart(ctxCat, {
          type: 'pie',
          data: {
            labels: catLabels, datasets: [{data: catValues}]
          },
          options: {
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  color: '#cbd5e1'
                }
              }
            }
          }
        });
      }

      if (document.getElementById('dayChart')) {
        const ctxDay = document.getElementById('dayChart').getContext('2d');
         new Chart(ctxDay, {
          type: 'bar',
          data: {
            labels: dayLabels,
            datasets: [{
              label: 'Total',
              data: dayValues,
              backgroundColor: 'rgba(56, 189, 248, 0.5)',
              borderColor: 'rgba(56, 189, 248, 1)',
              borderWidth: 1
            }]
          },
          options: {
            plugins: {
              legend: {
                labels: {
                  color: '#cbd5e1'
                }
              }
            },
            scales: {
              x: {
                ticks: {
                  color: '#cbd5e1'
                },
                grid: {
                  color: '#475569'
                }
              },
              y: {
                ticks: {
                  color: '#cbd5e1'
                },
                grid: {
                  color: '#475569'
                }
              }
            }
          }
        });
      }











      </script>

















    </main>
  </body>
</html>
